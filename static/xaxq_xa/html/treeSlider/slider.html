<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>属性</title>
    <link rel="stylesheet" type="text/css" href="../../js/easyui/themes/bootstrap/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../js/easyui/themes/icon.css">
    <script type="text/javascript" src="../../js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="../../js/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../../js/echarts.min.js"></script>
</head>
<body>
<!--     <div style="margin:20px 0;">
        <a href="javascript:void(0)" class="easyui-linkbutton" onclick="showGroup()">ShowGroup</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" onclick="hideGroup()">HideGroup</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" onclick="showHeader()">ShowHeader</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" onclick="hideHeader()">HideHeader</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" onclick="getChanges()">GetChanges</a>
        url:'./data/data.json',
    </div> -->
    <div id='treePic' style="width:345px;height:240px;"></div>
    <h4 style="margin:10px 0">属性</h5>
    <table id="pg" class="easyui-propertygrid" style="width:335px;margin:10px" data-options="
                method:'get',
                showGroup:false,
                scrollbarSize:0,
                columns: propColumnTitle
            ">
    </table>
 
     <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div style="width: 345px;height:300px;margin:5px 0">
        <div id="main" style="width: 330px;height:290px;"></div>
    </div>

    <script type="text/javascript">
        var console;
        if(!console) {
            console = external.parentWindow.console;
        }
        
        var propColumnTitle = [[{
            field: 'name',
            title: '名称',
            width: 100
        },{
            field: 'value',
            title: '值',
            width: 100
        }]];

        var treeProperty = external.parentWindow ? external.parentWindow.treePropertyObj : {
            name: '油松'
        };

        // add Info Pic
        $('#treePic').html('<h4 style="margin:0 0 10px 0">' + treeProperty.name +
            '<span id="ButtonClose" style="float: right; width: 25px; height: 25px;line-height:1;" class="closebtn"></span></h4>\
            <img style="width:230px;height:235px;margin-left:60px;" src="../../data/statics/' + treeProperty.name + '.png"></img>');
       
        // external.parentWindow.console.log('treeProperty', treeProperty);
        //渲染 熟悉
        function showGroup(){
            $('#pg').propertygrid({
                showGroup:true
            });
        }
        function hideGroup(){
            $('#pg').propertygrid({
                showGroup:false
            });
        }
        function showHeader(){
            $('#pg').propertygrid({
                showHeader:true
            });
        }
        function hideHeader(){
            $('#pg').propertygrid({
                showHeader:false
            });
        }
        function getChanges(){
            var s = '';
            var rows = $('#pg').propertygrid('getChanges');
            for(var i=0; i<rows.length; i++){
                s += rows[i].name + ':' + rows[i].value + ',';
            }
            alert(s)
        }

                   
        $.getJSON('../../data/treePrice2.json', {}, function(treePriceData){

                // debugger

                // external.parentWindow.console.log(treePriceData);
                // var treeProp= treePriceData.each(function(i,item){
                //     external.parentWindow.console.log(item);
                //     if(item.name == treeProperty.name){
                        
                //         return item;
                //     }
                // });

                // external.parentWindow.console.log('treeProperty', treeProperty);
                
                var treeProp = {};

                // external.parentWindow.console.log(treePriceData);

                for(var indexPrice in treePriceData) {
                    
                    var item = treePriceData[indexPrice];

                    if(item.speci == treeProperty.name) {
                        treeProp = item;
                        break;
                    }
                }
                
                // treeProp = treePriceData.find(function(item){
                //     return item.name == treeProperty.name;
                // });
               
                // for( var indexPrice in tree1688) {
                //     var item = tree1688[indexPrice];

                //     if(item.name == treeProperty.name) {
                //         tree1688Prop = item;
                //         break;
                //     }
                // }

                var row = {
                    name: '树种',
                    value: treeProp.name,
                    group: 'Group1',
                    editor: 'text'
                };

                treeProp.ali1688 = (treeProp.ali1688 || 0) / 100;

                var rowData = [
                    {"name":"树种","value": treeProp.name,"group":"基础信息","editor":"text"},
                    {"name":"规格","value": treeProp.speci2,"group":"基础信息","editor":"text"},
                    {"name":"备注","value": treeProp.remark,"group":"基础信息","editor":"text"},
                    {"name":"价格(北京住建委)","value": treeProp.beijing + '元',"group":"基础信息","editor":"text"},
                    {"name":"价格(河北市场价)","value": treeProp.hebei + '元',"group":"基础信息","editor":"text"},
                    {"name":"价格(阿里1688)","value":  treeProp.ali1688 + '元',"group":"基础信息","editor":"text"}
                ];

                // tree1688Prop = tree1688.find(function(item){
                //     return item.name == treeProperty.name;
                // });

                for( var rowItem in rowData) {
                    // external.parentWindow.console.log('rowItem', rowItem);
                    $('#pg').propertygrid('appendRow',rowData[rowItem]);
                }
                // rowData.forEach(function(rowItem){
                //     $('#pg').propertygrid('appendRow',rowItem);
                // });

                createEChartByData(treeProp);
        });

        

        function createEChartByData(treePrice) {
            // 基于准备好的dom，初始化echarts实例
            var myChart = echarts.init(document.getElementById('main'));

            // console.log(tree1688.history);

            for(var itemKey in treePrice.ali1688_history) {
                treePrice.ali1688_history[itemKey] = treePrice.ali1688_history[itemKey] / 100;
            }

            var option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        crossStyle: {
                            color: '#999'
                        }
                    }
                },
                grid: {
                    left: '22%',
                    top: '20%'
                },
                legend: {
                    left: 2,
                    top: 2,
                    itemGap: 5,
                    data:['北京', '河北','1688','价格趋势']
                },
                xAxis: [
                    {
                        type: 'category',
                        data: ['价格'],
                        axisPointer: {
                            type: 'shadow'
                        }
                    }, {
                        type: 'category',
                        position: 'top',
                        data: ['5月', '6月', '7月', '8月', '9月', '10月'],
                        maxInterval: 2,
                        boundaryGap: ['2%', '2%']
                    }
                ],
                yAxis: [
                    {
                        type: 'value',
                        name: '价格',
                        nameGap: 25,
                        axisLabel: {
                            formatter: '{value} 元'
                        }
                    },
                ],
                series: [
                    {
                        name:'北京',
                        type:'bar',
                        barGap: '200%',
                        barMaxWidth: 35,
                        data:[treePrice.beijing || 0]
                    },
                    {
                        name:'河北',
                        type:'bar',
                        barGap: '200%',
                        barMaxWidth: 35,
                        data:[treePrice.hebei || 0]
                    },
                    {
                        name:'1688',
                        type:'bar',
                        barGap: '200%',
                        barMaxWidth: 35,
                        data:[treePrice.ali1688]
                    },
                    {
                        name:'价格趋势',
                        type:'line',
                        xAxisIndex:1,
                        data:treePrice.ali1688_history || []
                    }
                ]
            };


            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);
        }
    </script>
</body>
</html>